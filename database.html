<!DOCTYPE html>
<html>
	<head>
		<title>Databases</title>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
		<h1>Бази даних</h1>
		<div class="list1">
			<p>&emsp;&emsp;&emsp;&emsp;Зміст</p>
			<ol>
				<li><a href="#it1">Загальні означення</a></li>
				<li><a href="#it2">Реляційна алгебра</a></li>
				<li><a href="#it3">Обмеження цілісності</a>
					<ol>
						<li><a href="#a1">Потенційний ключ</a></li>
						<li><a href="#a2">Первинний ключ</a></li>
						<li><a href="#a3">Суперключ</a></li>
						<li><a href="#a4">Зовнішній ключ</a></li>
						<li><a href="#a5">Тригери</a></li>
						<li><a href="#a6">Курсор</a></li>
						<li><a href="#a7">Обмеження цілісності рівня БД (ASSERTION)</a></li>
						<li><a href="#a8">Збережені процедури</a></li>
					</ol>
				</li>
				<li><a href="#it4">Нормальні форми</a>
					<ol>
						<li><a href="#b1">НФ1</a></li>
						<li><a href="#b2">НФ2</a></li>
						<li><a href="#b3">НФ3</a></li>
					</ol>
				</li>
				<li><a href="#it5">Індекси</a></li>
				<li><a href="#it6">Транзакції</a>
					<ol>
						<li><a href="#f1">ACID</a></li>
						<li><a href="#f2">Журнал транзакцій</a></li>
						<li><a href="#f3">Аномалії при паралельній обробці</a></li>
						<li><a href="#f4">Рівні ізоляції транзакцій</a></li>
					</ol>
				</li>
				<li><a href="#it7">NOSQL</a></li>
				

			</ol>
		</div>
		<h2 id="it1">Загальні означення</h2>
		<p>
			<em>База даних</em> - колекція структурованих даних. 
		</p>
		<p> <em>Домен</em> - обмежена підмножина значень даного типу. Тип - множина значень.  </p>
		<p>
			T<sub>i</sub>, i=1,...n - множина типів<br>
			<em>Кортежем</em>, визначеним з допомогою цих типів, називається множина впорядкованих трійок &lt;A<sub>i</sub>,T<sub>i</sub>,v<sub>i</sub>>, де<br>
			&emsp;A<sub>i</sub> - ім'я атрибута<br>
			&emsp;T<sub>i</sub> - ім'я типа<br>
			&emsp;v<sub>i</sub> - значення типу T<sub>i</sub><br>
		</p>
		<p>
			&lt;A<sub>i</sub>,T<sub>i</sub>> - атрибут<br>
			v<sub>i</sub> - значення атрибута
		<p>
		<img src="images/Relational_model_concepts_ua.svg.png">
		<p>
			<em>Функціональна залежність</em> над відношенням R є твердженням в такій формі:<br>
			Якщо два кортежі R мають всі однакові атрибути A<sub>1</sub>,A<sub>2</sub>,...A<sub>n</sub>, то вони мають мати однаковими всі атрибути іншого списку атрибутів B<sub>1</sub>,B<sub>2</sub>...B<sub>m</sub>.
			<br>
			A<sub>1</sub>,A<sub>2</sub>,...A<sub>n</sub>&rarr;B<sub>1</sub>,B<sub>2</sub>...B<sub>m</sub> <br>
			<em>Приклад.</em><br>
			<img src="images/funcdep.png"><br>
			title,year&rarr;length,genre,studioName - визначають функціональну залежність<br>
			title,year&rarr;starName - не задовольняють ФЗ
		</p>
		<p>
			<em>ER-діаграма</em> - entity-relationship. Один з типів UML діаграм. 
		</p>
		<h2 id="it2">Реляційна алгебра</h2>
		<p>Базові реляційні оператори (вхідні відношення повинні належати до одного типу):</p>
		<ul>
			<li>об'єднання</li>
			<li>перетин</li>
			<li>різниця</li>
			<li>декартів добуток - множина всіх таких впорядкованих пар, що в кожній парі перший елемент - із першої множини, другий - із другої.</li>
			<li>проекція - з відношення R отримуємо тільки деякі колонки R.<br>
				&emsp;&emsp;	&#8719;<sub>A<sub>1</sub>,A<sub>22</sub>,...,A<sub>n</sub></sub>(R)=A<sub>1</sub>,A<sub>22</sub>,...,A<sub>n</sub> of R
			</li>
			<li>вибірка - з відношення R отримуємо тільки деякі рядки<br>
				&emsp;&emsp; &#1004;<sub>C</sub>(R), де С - умова.
			</li>
			<li>перейменування - результат застосування оператора ідентичний R за вийнятком того, що поле b в усіх кортежах перейменовується на поле a.<br>
				&emsp;&emsp; &#961;<sub>a/b</sub>(R)
			</li>
		</ul>
		<p>
			Інші реляційні оператори: сортування, вилучення дублікатів, агрегація,групування, джойни.
		</p>
		<h2 id="it3">Обмеження цілісності</h2>
		<p>
			Обмеження цілісності визначають множину допустимих станів і переходи між ними.
		</p>
		<p>
			Класи обмежень за способом підтримки:
		</p>
		<ul>
			<li>декларативні<br>
			&emsp;&emsp; фіксують умови, яким має відповідати база даних.<br>
			&emsp;&emsp; специфікуються CONSTRAINTS.
			</li>
			<li>процедурні<br>
			&emsp;&emsp; описи дій, спрямованих на забезпечення цілісності<br>
			&emsp;&emsp; специфікуються тригерами.
			</li>
		</ul>
		<p id="a1"><strong>a)Потенційний ключ</strong></p>
		<ul style="list-style-type: circle;">
			<li>унікальність</li>
			<li>мінімальність</li>
		</ul>
		<p>
			Підмножина атрибутів відношення, яка унікально визначає запис, а також не може бути скорочена.
		</p>
		<p>
			Гарантований спосіб точно вказати який-небудь кортеж - вказати значення потенційного ключа.
		</p>
		<p id="a2"><strong>b)Первинний ключ</strong></p>
		<p>
			Один вибраний потенційний ключ.
		</p>
		<p id="a3"><strong>c)Суперключ</strong></p>
		<p>
			Множина атрибутів (або один з атрибутів), яка унікально ідентифікує рядки в таблиці.
		</p>
		<p>
			Потенційний ключ - мінімальний суперключ.
		</p>
		<p><em>Приклад</em></p>
		<table>
			<tr>
    			<th>ім'я</th>
    			<th>номер</th>
   				<th>династія</th>
  			</tr>
  			<tr>
    			<td>Едвард</td>
    			<td>II</td>
    			<td>Плантагенет</td>
  			</tr>
  			<tr>
    			<td>Едвард</td>
    			<td>III</td>
    			<td>Плантагенет</td>
  			</tr>
  			<tr>
    			<td>Річард</td>
    			<td>III</td>
    			<td>Плантагенет</td>
  			</tr>
  			<tr>
    			<td>Генрі</td>
    			<td>IV</td>
    			<td>Панкастер</td>
  			</tr>
		</table>
		<p>
		{ім'я,номер} - потенційний ключ,<br>
		{ім'я,номер,династія}
		</p>

		<p id="a4"><strong>d)Зовнішній ключ</strong></p>
		<p>
			Атрибут(набір атрибутів) в деякому відношенні R, який відповідає первинному ключу іншого відношення або того ж таки відношення. 
		</p>
		<p>
			Посилальна цілісність - необхідна риса БД, яка полягає у відсутності в будь-якому з її відношень зовнішніх ключів, що посилаються на відсутні кортежі.
		</p>
		<p id="a5"><strong>e)Тригери</strong></p>
		<p>
			Тригер - збережена процедура особливого типу,яку користувач не викликає явно, а використання якої обумовлено настанням визначеної події у реляційній БД:

		</p>
		<ul>
			<li>INSERT</li>
			<li>DELETE</li>
			<li>UPDATE</li>

		</ul>
		<p>
			Автоматично запускається сервером. Зміни відбуваються у вигляді транзакцій.
		</p>
		<p><em>Приклад</em></p>
		<p class="code">
			CREATE OR REPLACE TRIGGER SupplierUpdatedTrigger<br>
			ALTER UPDATE ON supplier<br>
			BEGIN<br>
			&emsp;INSERT INTO infoTable VALUES('table supplier has changed');<br>
			END;<br>
		</p>
		<p id="a6"><strong>f)Курсор</strong></p>
		<p>
			Курсор - об'єкт БД, який дозволяє застосуванням процювати з записами "по одній", а не зразу з  множиною, як в звичайних SQL командах.
		</p>
		<p>Курсор буває:</p>
		<ul>
			<li>явним - об'являється розробником</li>
			<li>неявним - не потребує об'явлення</li>
		</ul>
		<p>Може повертати один рядок, кілька рядків бо жодного рядка. Курсор слід закривати, а потім знову відкривати.</p>
		<p>Оператори управління явним курсором:</p>
		<ul>
			<li>DECLERE</li>
			<li>OPEN</li>
			<li>FETCH - послідовне вилучення рядків</li>
			<li>CLOSE</li>
		</ul>
		<p>Атрибути:</p>
		<ul>
			<li>%ISOPEN</li>
			<li>%FOUND - чи знайдений рядок</li>
			<li>%NOTFOUND</li>
			<li>%ROWCOUNT</li>
		</ul>
		<p id="a7"><strong>g)Обмеження цілісності рівня БД (ASSERTION)</strong></p>
		<p>Assertion - предикат, що виражає умову, яку ми хочемо щоб БД постійно задовільняла.</p>
		<p>В SQL не підтримуються обмеження БД. В ньому підтримуються загальні обмеження, які в специфікації SQL називаються assertion. Обмеження на домен, функціональна залежність і посилальна цілісність є особливими формами assertion.</p>
		<p class="code">
			CREATE ASSERTION ass_name CHECK predicate<br>
			DROP ASSERTION<br>
		</p>
		<p><em>Приклад 1. </em>Значення статусу кожного поставщика повинно знаходитися в межах від 1 до 100.</p>
		<p class="code">CREATE ASSERTION SC1 CHECK<br>
		&emsp;&emsp;(NOT EXISTS( SELECT * FROM S<br>
		&emsp;&emsp;&emsp;&emsp;&emsp;WHERE S.STATUS&lt;0 OR<br>
		&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;S.STATUS>100));
		</p>
		<p><em>Приклад 1. </em>Різні постачальники не можкть мати однакових номерів постачальників.</p>
		<p class="code">
		CREATE ASSERTION SC2 CHECK<br>
		&emsp;&emsp;(UNIQUE (SELECT S.SNUM FROM S));
		</p>
		<p id="a8"><strong>h)Збережені процедури</strong></p>
		<p>Збережена процедура - підпрограма, доступна застосункам, які мають доступ до СКБД.</p>
		<p>Типові застосування:</p>
		<ul>
			<li>валідація даних</li>
			<li>механізми контролю доступу</li>
			<li>централізація логіки</li>
		</ul>
		<p class="code">
		CALL PROCEDURE(...)<br>
		IF,WHILE,LOOP,REPEAT,CASE ...<br>
		</p>
		<h2 id="it4">Нормальні форми</h2>
		<p>Нормалізація БД - покроковий процес розбиття одного відношення відповідно до алгоритму нормалізації на декілька відношень на базі функціональних залежностей. Уникнення надмірності.</p>
		<p id="b1"><strong>a)НФ1.</strong></p>
		<ul>
			<li>не може мати двох однакових рядків</li>
			<li>значення атрибутів є атомарними(кожен атрибут повинен мати лише одне значення, а не множину значень)</li>
		</ul>
		<p id="b2"><strong>b)НФ2.</strong></p>
		<ul>
			<li>відношення в НФ1</li>
			<li>немає атрибутів, що залежать від частини потенційного ключа</li>
		</ul>
		<p id="b3"><strong>c)НФ3.</strong></p>
		<ul>
			<li>відношення в НФ2</li>
			<li>Кожен неключовий атрибут відношення R нетранзитивно (безпосередньо) залежить від кожного потенційного ключа в R.</li>
		</ul>
		<h2 id="it5">Індекси</h2>
		<p>Індекс- об'єкт БД, призначений для пришвидшення пошуку і сортування даних.</p>
		<p>Індекси пришвидшують пошук, join по атрибутах. Додавання, видаленн, зміна таблиці стають складнішими і повільнішими.</p>
		<p>Одновимірні ідекси створюються за допомогою hash-функцій і B-дерев(вид збалансованих дерев).</p>
		<p class="code">CREATE INDEX KeyIndex ON Movies(title,year)</p>
		<p><strong>a)Щільні індекси.(Clustered index)</strong></p>
		<p>Визначає фізичний порядок даних в таблиці. Зцієї причини таблиця може мати лише один щільний індекс.</p>
		<p>primary key - автоматичне створення clustered index. Індекс може мати кілька колонок.</p>
		<p>Аналогією є телефонний довідник, де дані посортовані за прізвищем.</p>
		<p class="code">CREATE Clustered Index ___ ON EmployeeTable(Gender Desc,Salary Asc)</p>
		<p><strong>b)Розріджені індекси.(Non-clustered index)</strong></p>
		<p>Як індекс в книжці. Дані зберігаються в одному місці, індекс - в іншому. Індекс містить вказівники на місце зберігання даних.</p>
		<p>Щільний індекс є швидший так, як працює безпосередньо з таблицею і він не потребує додаткового місця на диску.</p>
		<h2 id="it6">Транзакції</h2>
		<p>Транзакція - група послідовних операцій з базою даних, яка є логічною одиницею роботи з даними. Гарантує збереження цілісності бази даних.</p>
		<p id="f1"><strong>a)ACID</strong></p>
		<ul>
			<li>atomicity</li>
			<p>Всі команди або виконані або скасовані одночасно. Якщо команди виконалися частково відбувається rollback. </p>
			<li>consistency</li>
			<p> Cистема знаходиться в узгодженому стані до початку транзакції і повинна залишитись в узгодженому стані після завершення транзакції.</p>
			<p>Наприклад, при переведенні коштів з рахунка на рахунок, кошти можуть спочатку зніматись з першого рахунку, після чого нараховуватись на другий. Відповідно, після зняття коштів, але до їх нарахування система перебуває в неузгодженому стані — коштів немає на жодному з рахунків. Але після завершення транзакції повна сума перебуватиме на другому (або першому у випадку скасування транзакції) рахунку.</p>
			<li>isolation</li>
			<p>Транзакція не втручається в іншу транзакцію.</p>
			<li>durability</li>
			<p>Якщо користувач отримав підтверждення від системи, що транзакція виконана, він може бути впевнений, що зміни, які він зробив, не будуть відмінені через будь-який збій.</p>
		</ul>
		<p id="f2"><strong>b)Журнал транзакцій</strong></p>
		<p>В журнал транзакції записується інформація, необхідна для повернення БД в попередній стан:</p>
		<ol>
			<li>порядковий номер, тип і час зміни</li>
			<li>ідентифікатор транзакції</li>
			<li>об'єкт, який змінили</li>
			<li>попередній і новий стан</li>
		</ol>
		<p>Rollback (логічна відмова) - журнал сканується ззаду і всі записи транзакції виводяться.</p>
		<p>Rollforward (фізична відмова) - журнал сканується в прямому напрямку, починаючи з попередньої контрольної точки. Всі записи до кінця журналу. </p>

		<p id="f3"><strong>с)Аномалії при паралельній обробці</strong></p>
		<ul>
			<li>update lost</li>
			<p>При одночасній зміні одного блоку даних різними транзакціями, одна із змін втрачається.</p>
			<li>dirty read</li>
			<p>Читання даних, які додані чи змінені транзакцією, яка потім відкотилася.</p>
			<li>non-repeatable read</li>
			<p>При повторному читанні в рамках однієї транзакції, раніше прочитані дані з'являються зміненими.</p>

			<li>phantom read</li>
			<p>Одна транзакція в ході свого виконання декілька разів вибирає множину рядків за одними і тими ж критеріями. Інша транзакція додає, видаляє чи змінює рядки. В результаті, одні і ті ж вибірки в першій транзакції дають різні множини рядків.</p>

		</ul>
		<p id="f4"><strong>d)Рівні ізоляції транзакцій</strong></p>
		<table>
			<tr>
				<th></th><th></th>
				<th>dirty read</th>
				<th>non-repeatable read</th>
				<th>phantom read</th>

			</tr>
			<tr>
				<td>read uncommitted</td>
				<td>читання незафіксованих змін як своєї транзакції, так і паралельних транзакцій. </td>
				<td class="centr">+</td>
				<td class="centr">+</td>
				<td class="centr">+</td>
				
			</tr>
			<tr>
				<td>read committed</td>
				<td>читання всіх змін своєї транзакції і зафіксованих змін паралельних транзакцій. </td>
				<td class="centr">-</td>
				<td class="centr">+</td>
				<td class="centr">+</td>
				
			</tr>
			<tr>
				<td>repeatable read</td>
				<td> читання всіх змін своєї транзакції, будь-які зміни, внесені паралельними транзакціями після початку своєї, є недоступними. </td>
				<td class="centr">-</td>
				<td class="centr">-</td>
				<td class="centr">+</td>
				
			</tr>
			<tr>
				<td>serializable</td>
				<td> впорядковані транзакції</td>
				<td class="centr">-</td>
				<td class="centr">-</td>
				<td class="centr">-</td>
			</tr>
		</table>
		<h2 id="it7">NOSQL</h2>
		<a href="hibernate.html"><img src="images/next.png" width="200px" height="150px"></a>
	</body>
</html>